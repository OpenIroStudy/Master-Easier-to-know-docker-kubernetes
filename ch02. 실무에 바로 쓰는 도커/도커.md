목차 
* 컨테이너란
* 도커 개념
* Docker와 VM의 차이
* 도커의 기능
* 도커 네트워크
* 도커 컴포즈

<hr> 

# 컨테이너란

* 호스트 OS상에 논리적인 컨테이너를 만들고, 애플리케이션을 작동시키기 위해 필요한 라이브러리나 애플리케이션 등을 하나로 모아, 마치 별도의 서버인 것처럼 사용할 수 있게 만든 기술

* 이미지가 실행된 형태

  * 이미지 :

    * 소프트웨어 구동에 필요한 의존과 명세를 담고 있다.

    * 컨테이너를 실행하기 위한 읽기 전용 파일

  * Dockerfile : 

    * 이미지를 만들기 위한 명세


![image](https://user-images.githubusercontent.com/67637716/194277730-c08f2739-4e62-42bc-89d2-b8f476900054.png)



# 도커 개념

애플리케이션의 실행에 필요한 환경을 하나의 이미지로 모아 두고, 그 이미지를 사용하여 다양한 환경에서 애플리케이션 실행 환경을 구축 및 운용하기 위한 오픈소스 플랫폼. 

도커는 이미지 관리, 컨테이너 실행, 컨테이너 상태 관리를 쉽게 도와주는 도구



웹 시스템 개발 시 애플리케이션을 제품 환경에서 가동하기 위해서는 다음과 같은 요소가 필요하다.

* 애플리케이션의 실행 모듈(프로그램 본체)

* 미들웨어 & 라이브러리

* OS/네트워크 등과 같은 인프라 환경



<b>Docker에서는 이러한 인프라 환경을 컨테이너로 관리한다.</b>
애플리케이션 실행에 필요한 모든 파일 및 디렉토리들을 컨테이너로서 모아버린다. 
이러한 컨테이너의 바탕이 되는 Docker 이미지를 Docker Hub와 같은 리포지토리(repository)에 공유한다.
![image](https://user-images.githubusercontent.com/67637716/194278183-a9a5a1c2-eb89-4bde-b842-359781541478.png)  



이미지는 Docker가 설치되어 있는 환경이라면 기본적으로 어디서든지 작동되므로 '개발/테스트 환경에서 움직이지만 제품 환경에서는 움직이지 않는다' 는 리스크를 줄일 수 있다.

따라서 애플리케이션 개발부터 테스트, 제품 환경에 대한 전개를 모두 애플리케이션 엔지니어가 수행하는 것이 가능해진다. 



# Docker와 VM의 차이
![image](https://user-images.githubusercontent.com/67637716/194278287-07daa374-cdd9-4146-bf74-eeb659bfeb82.png)  

VM은 환경 자체 (OS)를 가상화 해버리는 반면, 도커 컨테이너는 호스트 OS의 커널을 공유하며 단순히 하나의 격리되어 있는 프로세스로써 동작한다. 

Hyper Visor를 띄워서 VM마다 OS를 두는 것보다 가볍다.

VM과 마찬가지로 컨테이너에는 자체 파일 시스템, CPU 공유, 메모리, 프로세스 공간 등이 있다.

VM이미지 사용에 비해 컨테이너 이미지 생성의 용의성과 효율성이 향상되었다.

빠르고 효율적인 롤백을 통해 안정적이고 빈번한 컨테이너 이미지 빌드 및 배포를 제공한다.


```  
기존 하이퍼바이저를 거치는 성능 저하를 막기 위해 컨테이너 방식의 가상화를 솔루션으로 구현한 것이 도커
컨테이너의 장점은 기존의 가상화처럼 게스트 운영체제를 포함하지 않기 때문에 속도가 빠르고 용량이 작고 배포에도 매우 용이.
```  


불완전한 격리(모든 애플리케이션을 한 대의 물리적인 서버에서 운영)를 수행하는 방법

*** Use Cgroup & Namespace of linux ***

Cgroup(Controll Group) - CPU, Mem, network, I/O 등의 자원을 제한하고 격리할 수 있는 커널 기능

Namespace - 시스템 리소스를 프로세스와 격리하는 기능

실제 격리는 이루어지지 않는다.

Cgroup, Namespace를 지원함으로써 일반적인 VM과 같이 물리적인 가상화를 쓰지 않아도 인프라를 운영함에 있어 더 좋은 성능을 보장.

https://seungyooon.tistory.com/142 

https://anweh.tistory.com/67



# 도커의 기능

Docker에는 크게 세 가지 기능이 있다.

* Docker 이미지를 만드는 기능 (Build)
* Docker 이미지를 공유하는 기능(Ship)
* Docker 컨테이너를 작동시키는 기능(Run)



### - Docker 이미지를 만드는 기능 (Build)

Docker는 애플리케이션의 실행에 필요한 프로그램 본체, 라이브러리, 미들웨어, OS나 네트워크 설정 등을 하나로 모아서 Docker 이미지를 만든다.

Docker에서는 하나의 이미지에는 하나의 애플리케이션만 넣어 두고, 여러 개의 컨테이너를 조합하여 서비스를 구축하는 방법을 권장한다.

Docker 이미지는 Dockerfile이라는 설정 파일을 만들어 그것을 바탕으로 자동으로 이미지를 만들 수 있다. 

CI, CD 관점에서 코드에 의한 인프라의 구성 관리를 생각하면 Dockerfile을 사용하여 관리하는 것이 바람직하다.



### - Docker 이미지를 공유하는 기능(Ship)

Docker 이미지는 Docker 레지스트리에 공유할 수 있다. 

Docker의 공식 레지스트리인 Docker Hub에서는 Ubuntu나 CentOS와 같은 Linux 배포판의 기본 기능을 제공하는 베이스 이미지를 배포하고 있다. 

이러한 베이스 이미지에 미들웨어나 라이브러리, 애플리케이션 등을 넣은 이미지를 겹쳐서 독자적인 Docker 이미지를 만들어 가는 것이다.

공식 이미지 외에도 개인이 작성한 이미지를 Docker Hub에서 자유롭게 공개하여 공유할 수가 있다. 이미 많은 Docker가 공개되어 있으므로 요건에 맞는 것을 다운로드하여 사용하면 된다. 

Docker 명령어로 Docker Hub에 로그인하여 레지스트리에 있는 이미지를 검색이나 업로드, 다운로드 할 수 있다.



### - Docker 컨테이너를 작동시키는 기능(Run)

Docker는 Linux 상에서 컨테이너 단위로 서버 기능을 작동시킨다.

Docker는 하나의 Linux 커널을 여러 개의 컨테이너에서 공유하고 있다. 

컨테이너 안에서 작동하는 프로세스를 하나의 그룹으로 관리하고, 그룹마다 각각 파일 시스템이나 호스트명, 네트워크 등을 할당하고 있다. 

그룹이 다르면 프로세스나 파일에 대한 액세스를 할 수 없다. 

이러한 구조를 사용하여 컨테이너를 독립된 공간으로서 관리한다. 

이를 실행하기 위해 Linux 커널 기능(namespacem, cgroups 등) 기술이 사용된다.



# 도커의 네트워크

#### 브릿지 모드

도커 네트워크의 default 설정이며 가장 많이 사용하는 네트워크

Docker 컨테이너가 실행되면 컨테이너에 172.17.0.0/16이라는 서브넷 마스크를 가진 프라이빗 IP 주소가 자동으로 할당된다.

도커를 설치하면 기본적으로 docker0이라는 네트워크 인터페이스가 생긴다.
docker0은 컨테이너들이 통신하기 위한 가상 Linux Bridge이다.
호스트와 같은 네트워크를 사용한다.
![image](https://user-images.githubusercontent.com/67637716/194278580-8dd5d55b-a40d-4c2a-bde2-3a3fa4840633.png)  



docker0 인터페이스는 172.17.0.0/16 서브넷을 갖기 때문에 컨테이너가 생성되면 이 대역 안에서 IP를 할당받게 된다. (예: 172.17.0.2, 172.17.0.3)
호스트 서버와 컨테이너들이 동일하게 네트워크 통신을 할 수 있도록 Linux bridge가 지원한다.



컨테이너는 외부와 통신하기 위해 2개의 네트워크 인터페이스를 함께 생성한다.
하나는 컨테이너 내부 Namespace에 할당되는eth0 이름의 인터페이스이고, 나머지 하나는 호스트 네트워크 브리지 docker0에 바인딩 되는 vethXXXXXXX이름 형식의 veth 인터페이스다. (“veth"는 “virtual eth"라는 의미)
컨테이너의 eth0인터페이스와 호스트의 veth 인터페이스는 서로 연결되어 있다.

결국 docker0 브리지는 veth 가상 인터페이스와 호스트의 eth0 인터페이스를 이어주는 중간 다리 역할을 한다.  
그리고 컨테이너 안에 eth0인터페이스는 veth 가상 인터페이스를 통해 외부와 통신할 수 있게 되는 것이다.  

![image](https://user-images.githubusercontent.com/67637716/194278628-d460132a-301b-4194-bcd7-b211f9559456.png)  
