#### 도커 레지스트리  
레지스트리는 소스 저장소와 비슷하다. Git을 사용하는 Github, Bitbucker 등이 소스를 저장할 떄 비슷한 방식을 사용하듯 레지스트리도 제공하는 벤더가 다를 뿐 저장 방식은 비슷하다.

<br><br>

<b> 대표적인 도커 레지스트리 : 도커 허브 </b>

https://hub.docker.com/  <br>
회원가입하고 도커 이미지를 업로드할 리포지토리를 만든다. <br>

![image](https://user-images.githubusercontent.com/43237961/174467443-83fc6b3c-8e99-4bd7-95c8-2b1e2d7733fd.png)  <br>
<br>
![image](https://user-images.githubusercontent.com/43237961/174467469-e5592004-17db-4336-b89f-24ba0930dce7.png)  <br>
<br>


로컬에 만든 이미지를 배포해보자!  <br>
![image](https://user-images.githubusercontent.com/43237961/174467602-39e32858-ce77-4533-a7af-99bf43d36f15.png)  <br>
<br>
dockerhub에 가입한 아이디와 비밀번호로 로그인을 한다.   


```linux
docker tag springboot yuniyang/custom-nginx:springboot
docker push yuniyang/custom-nginx:springboot
```


tag명령어를 사용하면 도커 이미지를 업로드할 수 있게 한다.   <br>
![image](https://user-images.githubusercontent.com/43237961/174467880-46bce456-0bc1-48a3-ba18-5e563b9bb61f.png)  <br>
<br>
로컬에서 업로드한 이미지가 잘 올라간 것을 확인할 수 있다. 

<br><br><br>

이전 테스트 서버 환경을 구축할 땐 그냥 도커 파일을 만들고 테스트 환경 자체에서 이미지를 만들어 배포하는 방식이었다면, 이제는 이 수작업의 역할을 CI 서버가 대신한다. <br>
CI 서버를 사용하면 도커 이미지의 물리적인 위치 또한 달라지기 때문에 앞에서 다룬 도커 레지스토리를 사용할 것이다. <br>

* 물리적으로 다른 위치에 있는 테스트 서버에는 어떻게 배포할 수 있을까?
  * 도커 레지스트리 이용 - 도커 허브 사용
  * 도커 레지스트리 운영 (실습)


<br><br>
도커 레지스트리 다운로드 후 컨테이너 생성
```linux
docker pull registry
docker run -d -p 5000:5000 --restart=always --name registry registry

이미지 다운로드 후 tag
docker pull ubuntu 
docker image tag ubuntu localhost:5000/ubuntu
```

 
![image](https://user-images.githubusercontent.com/43237961/174468141-de4baa50-070d-43dd-8a34-623855aa7101.png)  <br>
<br>


만들어놓은 컨테이너 localhost:5000으로 이미지를 푸시한다. <br>
![image](https://user-images.githubusercontent.com/43237961/174468185-00663272-6747-413a-ad4a-5f8ca988c86e.png)  <br><br>

테스트를 위해 gcp 클라우드 방화벽 규칙에서 5000번을 허용해야 한다. <br>
![image](https://user-images.githubusercontent.com/43237961/174468297-7baf1069-5dc9-490f-b125-1334089281a0.png) 
<br><br>  
![image](https://user-images.githubusercontent.com/43237961/174468509-2aa0f05c-f461-4996-b642-04e98f6826fa.png)  <br><br>
도커 레지스트리가 HTTPS로 통신할 수 있도록 도커 설정에 insecure registries를 추가한다. <br>

