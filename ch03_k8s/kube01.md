# 쿠버네티스
도커 오케스트레이션 중 가장 많이 쓰이는 제품이다.

* 쿠버네티스는 모놀리식(monolithic)이 아니어서, 이런 기본 솔루션이 선택적이며 추가나 제거가 용이하다.
> ### 모놀리식 아키텍처(Monolithic Architecture)
> 모놀리식 아키텍처란, 마이크로서비스 아키텍처의 반대되는 개념으로 전통의 아키텍처를 지칭하는 의미로 생겨난 단어이다. 
> 
> 하나의 서비스 또는 어플리케이션이 하나의 거대한 아키텍처를 가질 때, 모놀리식(Monolithic)하다고 한다.
* 쿠버네티스는 분산 시스템을 탄력적으로 실행하기 위한 프레임 워크를 제공한다. 
* 애플리케이션의 확장과 장애 조치를 처리하고, 배포 패턴 등을 제공한다. 예를 들어, 쿠버네티스는 시스템의 카나리아 배포를 쉽게 관리 할 수 있다.
https://kubernetes.io/ko/docs/concepts/overview/what-is-kubernetes/

> ### 카나리(Canary)
> 카나리아 배포는 위험을 빠르게 감지할 수 있는 배포 전략이다.
> 
> 지정한 서버 또는 특정 user에게만 배포했다가 정상적이면 전체를 배포한다.
> 
> 서버의 트래픽의 일부를 신 버전으로 분산하여 오류 여부를 확인할 수 있다.
> 
> 이런 전략은 A/B 테스트가 가능하며, 성능 모니터링에 유용하다.
> 
> 트래픽을 분산시킬 때는 라우팅을 랜덤하게 할 수 있고, 사용자로 분류할 수도 있다.
> 
> <img width="783" alt="스크린샷 2022-06-27 오후 10 03 56" src="https://user-images.githubusercontent.com/82895809/175948236-8267bce4-1d44-473f-a448-9ba6bb6220ee.png">

## 쿠버네티스 아키텍처
도커가 컨테이너와 관련된 전반적이고 추상화된 기술을 제공한다고 하면, 쿠버네티스는 다량의 컨테이너를 하나의 물리적인 서버에 배치하여 이를 사용하듯이 관리해주는 역할을 한다.

쿠버네티스의 영역은 크게 노드를 하나로 묶는 클러스터를 관리하는 컨트롤 플레인 영역과 흩어져 있는 각 노드를 관리하는 노드 영역으로 나눌 수 있다.

### 클러스터

쿠버네티스 아키텍처에서 클러스터(Cluster)란 컨테이너 형태의 애플리케이션을 호스팅하는 물리/가상 환경의 노드들로 이루어진 집합을 의미한다.

온라인 인프라 영역에서의 컨테이너가 화물선에 선적되는 실물 컨테이너 개념에 비유된다면, 쿠버네티스 클러스터는 컨테이너들을 실은 컨테이너선과 이를 관리하는 통제함으로 이루어진 선단의 개념에 비유할 수 있는 것이다.

쿠버네티스 클러스터는 용도에 따라 크게 워커 노드(Worker Node)와 마스터 노드(Master Node)로 구분된다.

* 워커 노드(Worker Node) : 각기 다른 컨테이너들이 선적된 컨테이너선의 역할이다. 각기 다른 목적과 기능으로 세분화된 컨테이너들이 실제 배치되는 노드를 의미한다.

* 마스터 노드(Master Node) : 컨테이너 선단을 지휘하는 통제함의 역할이다. 대규모의 컨테이너를 운영하려면 각 워커 노드들의 가용 리소스 현황을 고려하여 최적의 컨테이너 배치와 모니터링, 그리고 각 컨테이너에 대한 효율적인 추적 관리가 필요해진다. 쿠버네티스 클러스터에서 이 역할을 수행하는 노드를 마스터 노드라 칭한다.

쿠버네티스를 배포하면 클러스터를 얻는다.

쿠버네티스 클러스터는 컨테이너화된 애플리케이션을 실행하는 노드라고 하는 워커 머신의 집합. 모든 클러스터는 최소 한 개의 워커 노드를 가진다.

워커 노드는 애플리케이션의 구성요소인 파드를 호스트한다. 컨트롤 플레인은 워커 노드와 클러스터 내 파드를 관리한다. 프로덕션 환경에서는 일반적으로 컨트롤 플레인이 여러 컴퓨터에 걸쳐 실행되고, 클러스터는 일반적으로 여러 노드를 실행하므로 내결함성과 고가용성이 제공된다.

* 내결함성(Fault Tolerance) : 시스템의 일부 구성 요소가 작동하지 않더라도 계속 작동할 수 있는 기능
* 고가용성(High Availability) : 서버와 네트워크, 프로그램 등의 정보 시스템이 상당히 오랜 기간 동안 지속적으로 정상 운영이 가능한 성질

<img width="796" alt="스크린샷 2022-06-27 오후 10 24 34" src="https://user-images.githubusercontent.com/82895809/175952450-041532f3-266f-4623-b52f-1cc44837bc1f.png">

### 컨트롤 플레인 컴포넌트
컨트롤 플레인 컴포너트는 클러스터에 관한 결정을 내리고 클러스터 이벤트를 감지하며 반응한다.

컨트롤 플레인 컴포넌트는 클러스터 내 어떠한 머신에서라도 동작할 수 있다.

* kube-apiserver : 쿠버네티스의 모든 컴포넌트의 통신을 담당.
* etcd : 모든 클러스터 데이터를 담는 쿠버네티스 뒷단의 저장소로 사용되는 일관성·고가용성 키-값 저장소
* kibe-scheduler : 노드가 배정되지 않은 새로 생성된 파드 를 감지하고, 실행할 노드를 선택하는 컨트롤 플레인 컴포넌트.
* kube-controller-manager : 컨트롤러 프로세스를 실행하는 컨트롤 플레인 컴포넌트.
<img width="616" alt="스크린샷 2022-06-27 오후 10 31 22" src="https://user-images.githubusercontent.com/82895809/175953794-16b20976-810c-48d0-8f19-1d4f7a49e4b9.png">

* cloud-controller-manager : 클라우드별 컨트롤 로직을 포함하는 쿠버네티스 컨트롤 플레인 컴포넌트. 클라우드 컨트롤러 매니저를 통해 클러스터를 클라우드 공급자의 API에 연결하고, 해당 클라우드 플랫폼과 상호 작용하는 컴포넌트와 클러스터와만 상호 작용하는 컴포넌트를 구분할 수 있게 해줌.
* node-component : 노드 컴포넌트는 동작 중인 파드를 유지시키고 쿠버네티스 런타임 환경을 제공하며, 모든 노드 상에서 동작.
* kubelet : 클러스터의 각 노드에서 실행되는 에이전트. Kubelet은 파드에서 컨테이너가 확실하게 동작하도록 관리.
* kube-proxy : kube-proxy는 클러스터의 각 노드에서 실행되는 네트워크 프록시로, 쿠버네티스의 서비스 개념의 구현부.
* container-runtime : 컨테이너 런타임은 컨테이너 실행을 담당하는 소프트웨어. 쿠버네티스는 containerd, CRI-O와 같은 컨테이너 런타임 및 모든 Kubernetes CRI (컨테이너 런타임 인터페이스) 구현체를 지원.

## 쿠버네티스 설치
토큰 재발급 (토큰은 24시간의 제한 시간 있음)
```
kubeadm token create —print-join-command
```

### 파드 네트워크 Add-On 설치
통신을 하기 위해서는 Pod Network Add-On을 설치해야 한다.

파드들의 배포와 통신을 위해 네트워크를 설정해야 하기 때문이다.

만약 이 과정을 거치지 않는다면 파드 배포가 불가능해진다.

각 클러스터마다 Network Add-On 하나씩만 설치할 수 있다.
